---
title: "exercise_four_survival_analysis"
author: "Jonas Engström"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{exercise_four_survival_analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Exercise Survival Analysis

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(appstats2)
```

The instructions below are copied from e-mail correspondence regarding the course [Applied Statistics II](https://canvas.education.lu.se/courses/34580) at Lund University.

## Basic survival analysis:

Load the dataset **bloodpressure** (of course from SYNTAX, do-file or R-script).

This is data from a cohort study with primary outcome time to coronary heart disease (chd). The aim was to study risk factors such as systolic and diastolic blood pressure (SBP and DBP), serum cholesterol (SCL) and BMI but also characteristics such as age and sex have been registered.

The outcome in survival analysis consists of two variables, follow-up time and an event indicator. The time variable in thos dataset is fu_years and the event indicator is chd_event coded 0 for censoring (no chd-event recorded during follow-up) and 1 for event (chd).

1. What is the proportion of subjects who have experienced a chd event during follow-up?

2. What is the median follow-up (and range) for subjects who have not yet experienced an event?

3. Draw the corresponding Kaplan-Meier graph showing the estimated probability of being chd-event-free as a function of follow-up time and estimate the median time to coronary heartdisease in the population from which the sample was drawn (Hint: read the following lines if you get stuck here).

Tricky question, I admit that. The median time to chd event, in the population from which the sample was drawn, cannot be estimated when the Kaplan-Meier estimate does not drop below 50%. Longer follow-up is required.

Overweight is a risk factor for chd:

4. Create a new variable overweight as BMI≥25 kg/m^2^.

5. Draw a Kaplan-Meier graph of chd-event-free survival with separate estimates for the two weight categories. Interpretation?

6. Test if the difference between the two “Survival curves” is significant (hint: logrank test).

We will later in the course use regression models to “control for” confounding factors, but first we try the much simpler method of stratification.

We might suspect that age is a confounder when studying the association between overweight and chd. Stratify age at the median, which turns out to be 45 years.

7. Define old as age>45.

8. Evaluate the “effect of overweight” separately for young and old subject (Kaplan-Meier and logrank). Do we have evidence against the null hypothesis (chd-event-free survival the same in both BMI groups) for both young and old subjects in the population from which the sample was drawn?

## Cox regression:

The by far most commonly used regression model for survival data is the Cox model. Contrary to the logrank test, this method gives us an effect measure – the hazard ratio (HR). Furthermore, the model provides a framework for multivariable adjustment for confounding and for development of multivariable predictors of survival (more about that later in this course).

For SPSS-users: Don’t forget to SET SPLIT FILE OFF before you continue.

9. Above we studied overweight as a risk factor for coronary heart disease graphically using a Kaplan-Meier graph and numerically using a logrank-test. Now, fit the corresponding univariable Cox-model with overweight as the only covariate and interpret the effect estimate.

The effect estimate corresponding to this model is a hazard ratio. We have hence estimated the ratio of the chd rates (number of chd:s per time unit) in the two groups. Note that we have only 0 or 1 event per subject. More advanced methods are necessary to handle multiple episodes (dependent) data.

10. Compare the *P*-value from the log-rank test to that of the effect estimate in the Cox-model. These are usually very close to each other if the proportional hazards assumption is fulfilled.

11. Do you think that the underlying assumption of proportional hazards is reasonably well fulfilled for the Cox-model fitted above?
